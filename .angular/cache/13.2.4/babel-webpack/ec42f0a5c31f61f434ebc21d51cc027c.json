{"ast":null,"code":"import { forkJoin } from \"rxjs\";\nimport { AddGroupDialogComponent } from \"./components/add-group-dialog/add-group-dialog.component\";\nimport { ConfirmDialogComponent } from \"../../../../shared/components/confirm-dialog/confirm-dialog.component\";\nimport { BaseComponent } from \"../../../../core/base.component\";\nimport { AddOrEditUserComponent } from \"./components/add-or-edit-user/add-or-edit-user.component\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../setting.service\";\nimport * as i2 from \"@ngneat/transloco\";\nimport * as i3 from \"@angular/material/card\";\nimport * as i4 from \"@angular/material/button\";\nimport * as i5 from \"@angular/material/icon\";\nimport * as i6 from \"./group-list/group-list.component\";\nimport * as i7 from \"@angular/material/form-field\";\nimport * as i8 from \"@angular/material/input\";\nimport * as i9 from \"@angular/forms\";\nimport * as i10 from \"@angular/material/select\";\nimport * as i11 from \"@angular/material/core\";\nimport * as i12 from \"@angular/common\";\nimport * as i13 from \"../../../../layout/common/data-table/data-table.component\";\n\nfunction UserComponent_ng_container_0_mat_option_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const authority_r5 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", authority_r5.name);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(authority_r5.name);\n  }\n}\n\nfunction UserComponent_ng_container_0_ng_template_35_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 26);\n    i0.ɵɵlistener(\"click\", function UserComponent_ng_container_0_ng_template_35_Template_button_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const row_r6 = restoredCtx.$implicit;\n      const ctx_r7 = i0.ɵɵnextContext(2);\n      return ctx_r7.addOrEditUser(row_r6);\n    });\n    i0.ɵɵelement(1, \"mat-icon\", 27);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"button\", 28);\n    i0.ɵɵelement(3, \"mat-icon\", 29);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵstyleProp(\"color\", \"orange\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵstyleProp(\"color\", \"red\");\n  }\n}\n\nfunction UserComponent_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 1)(2, \"div\", 2)(3, \"mat-card\", 3)(4, \"div\", 4)(5, \"div\", 5);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"div\", 6)(8, \"button\", 7);\n    i0.ɵɵlistener(\"click\", function UserComponent_ng_container_0_Template_button_click_8_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return ctx_r9.openAddOrEditGroupDialog();\n    });\n    i0.ɵɵelement(9, \"mat-icon\", 8);\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"div\", 9)(12, \"app-group-list\", 10);\n    i0.ɵɵlistener(\"groupChange\", function UserComponent_ng_container_0_Template_app_group_list_groupChange_12_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return ctx_r11.paginate.groupId = $event;\n    })(\"groupChange\", function UserComponent_ng_container_0_Template_app_group_list_groupChange_12_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return ctx_r12.getListUser();\n    })(\"action\", function UserComponent_ng_container_0_Template_app_group_list_action_12_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return ctx_r13.groupAction($event);\n    });\n    i0.ɵɵelementEnd()()()()();\n    i0.ɵɵelementStart(13, \"div\", 11)(14, \"mat-card\", 3)(15, \"div\", 4)(16, \"div\", 5);\n    i0.ɵɵtext(17);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(18, \"div\", 12)(19, \"div\", 13)(20, \"div\", 14)(21, \"mat-form-field\", 15);\n    i0.ɵɵelement(22, \"mat-icon\", 16);\n    i0.ɵɵelementStart(23, \"input\", 17);\n    i0.ɵɵlistener(\"ngModelChange\", function UserComponent_ng_container_0_Template_input_ngModelChange_23_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return ctx_r14.paginate.keyword = $event;\n    })(\"keyup.enter\", function UserComponent_ng_container_0_Template_input_keyup_enter_23_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r15 = i0.ɵɵnextContext();\n      return ctx_r15.getListUser();\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(24, \"mat-form-field\", 18)(25, \"mat-select\", 19);\n    i0.ɵɵlistener(\"ngModelChange\", function UserComponent_ng_container_0_Template_mat_select_ngModelChange_25_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r16 = i0.ɵɵnextContext();\n      return ctx_r16.paginate.authority = $event;\n    })(\"selectionChange\", function UserComponent_ng_container_0_Template_mat_select_selectionChange_25_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r17 = i0.ɵɵnextContext();\n      return ctx_r17.getListUser();\n    });\n    i0.ɵɵelementStart(26, \"mat-option\", 20);\n    i0.ɵɵtext(27, \"All Role\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(28, UserComponent_ng_container_0_mat_option_28_Template, 2, 2, \"mat-option\", 21);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(29, \"div\", 22)(30, \"button\", 7);\n    i0.ɵɵlistener(\"click\", function UserComponent_ng_container_0_Template_button_click_30_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r18 = i0.ɵɵnextContext();\n      return ctx_r18.addOrEditUser();\n    });\n    i0.ɵɵelement(31, \"mat-icon\", 8);\n    i0.ɵɵtext(32);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(33, \"div\", 23)(34, \"app-data-table\", 24);\n    i0.ɵɵlistener(\"pageChange\", function UserComponent_ng_container_0_Template_app_data_table_pageChange_34_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r19 = i0.ɵɵnextContext();\n      return ctx_r19.changePage($event);\n    });\n    i0.ɵɵtemplate(35, UserComponent_ng_container_0_ng_template_35_Template, 4, 4, \"ng-template\", null, 25, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd()()()()()();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const t_r1 = ctx.$implicit;\n\n    const _r3 = i0.ɵɵreference(36);\n\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate1(\" \", t_r1(\"setting.user.group\"), \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", t_r1(\"setting.user.newGroup\"), \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"groups\", ctx_r0.groups)(\"group\", ctx_r0.paginate.groupId);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\" \", t_r1(\"setting.user.userList\"), \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"floatLabel\", \"always\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"svgIcon\", \"heroicons_solid:search\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.paginate.keyword);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.paginate.authority);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"value\", \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.authorities);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", t_r1(\"setting.user.newUser\"), \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"rows\", ctx_r0.users)(\"columns\", ctx_r0.columns)(\"paginate\", true)(\"limit\", ctx_r0.paginate.size)(\"count\", ctx_r0.paginate.total)(\"actionTemplate\", _r3);\n  }\n}\n\nexport let UserComponent = /*#__PURE__*/(() => {\n  class UserComponent extends BaseComponent {\n    constructor(injector, settingService) {\n      super(injector);\n      this.settingService = settingService;\n      this.columns = [{\n        columnDef: 'stt',\n        header: 'STT',\n        flex: 0.3\n      }, {\n        columnDef: 'login',\n        header: 'Tên đăng nhập'\n      }, {\n        columnDef: 'ip',\n        header: 'IP',\n        cellRenderer: element => `${element.userIpList.map(ip => ip.ipAddress).join(', ')}`,\n        flex: 1.5\n      }, {\n        columnDef: 'team',\n        header: 'Nhóm',\n        cellRenderer: element => {\n          var _a;\n\n          return `${(_a = element.team) === null || _a === void 0 ? void 0 : _a.name}`;\n        }\n      }, {\n        columnDef: 'typeUser',\n        header: 'Loại',\n        cellRenderer: element => `${element.typeUser === 1 ? 'SSO' : 'Thường'}`\n      }, {\n        columnDef: 'authority',\n        header: 'Nhóm quyền',\n        cellRenderer: element => `${element.authorities.map(auth => auth.name).join(', ')}`\n      }, {\n        columnDef: 'action',\n        header: 'Actions',\n        flex: 1.5\n      }];\n      this.groups = [];\n      this.users = [];\n      this.authorities = [];\n      this.paginate = {\n        keyword: '',\n        authority: '',\n        groupId: '',\n        size: 10,\n        page: 0,\n        total: 0\n      };\n    }\n\n    ngOnInit() {\n      this.initData();\n    }\n\n    initData() {\n      forkJoin([this.settingService.getListWpGroup(), this.settingService.query(this.paginate), this.settingService.getAuthority()]).subscribe(([groups, users, authorities]) => {\n        this.handleGroupResponse(groups);\n        this.handleUserResponse(users);\n        this.handleAuthoritiesResponse(authorities);\n      });\n    }\n\n    getListGroup() {\n      this.settingService.getListWpGroup().subscribe(res => {\n        this.handleGroupResponse(res);\n      });\n    }\n\n    handleGroupResponse(res) {\n      if ((res === null || res === void 0 ? void 0 : res.status) === 200) {\n        this.groups = res.body.results;\n      }\n    }\n\n    getListUser() {\n      this.settingService.query(this.paginate).subscribe(res => {\n        this.handleUserResponse(res);\n      });\n    }\n\n    handleUserResponse(res) {\n      if ((res === null || res === void 0 ? void 0 : res.status) === 200) {\n        this.users = res.body;\n        this.paginate.total = Number(res.headers.get('X-Total-Count'));\n      }\n    }\n\n    handleAuthoritiesResponse(res) {\n      this.authorities = res.results;\n      console.log(this.authorities);\n    }\n\n    changePage(e) {\n      this.paginate.size = e.pageSize;\n      this.paginate.page = e.pageIndex;\n      this.getListUser();\n    }\n\n    groupAction(e) {\n      switch (e.type) {\n        case 'edit':\n          this.openAddOrEditGroupDialog(e.data);\n          break;\n\n        case 'delete':\n          this.showDialog(ConfirmDialogComponent, {\n            width: '30vw'\n          }, value => {\n            if (value) {\n              this.deleteGroup(e.data);\n            }\n          });\n          break;\n\n        default:\n          break;\n      }\n    }\n\n    openAddOrEditGroupDialog(data) {\n      this.showDialog(AddGroupDialogComponent, {\n        data: data,\n        width: '40vw',\n        disableClose: true\n      }, value => value && this.getListGroup());\n    }\n\n    deleteGroup(data) {\n      this.settingService.deleteGroup(data.id).subscribe(res => {\n        this.showSnackBar('Xóa bản ghi thành công!', 'success');\n      });\n    }\n\n    addOrEditUser(userData) {\n      this.showDialog(AddOrEditUserComponent, {\n        data: {\n          userData,\n          groups: this.groups,\n          authorities: this.authorities\n        },\n        width: '60vw',\n        height: '90vh',\n        disableClose: true\n      });\n    }\n\n  }\n\n  UserComponent.ɵfac = function UserComponent_Factory(t) {\n    return new (t || UserComponent)(i0.ɵɵdirectiveInject(i0.Injector), i0.ɵɵdirectiveInject(i1.SettingService));\n  };\n\n  UserComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: UserComponent,\n    selectors: [[\"app-user\"]],\n    features: [i0.ɵɵInheritDefinitionFeature],\n    decls: 1,\n    vars: 0,\n    consts: [[4, \"transloco\"], [1, \"px-4\", \"flex\", \"md:px-6\", \"w-full\"], [1, \"w-1/4\", \"h-full\", \"pr-6\"], [1, \"bg-card\", \"h-full\"], [1, \"header\", \"border-b\"], [1, \"text-xl\", \"font-bold\", \"card-title\", \"mb-3\"], [1, \"content\", \"mt-4\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\"], [\"svgIcon\", \"heroicons_outline:plus\", 1, \"icon-size-6\", \"mr-2\"], [1, \"group-list\", \"my-4\"], [3, \"groups\", \"group\", \"groupChange\", \"action\"], [1, \"w-3/4\", \"h-full\"], [1, \"content\", \"mt-4\", \"w-full\"], [1, \"actions\", \"flex\", \"justify-end\"], [1, \"search-and-filter\", \"flex\", \"mr-4\", \"items-center\"], [1, \"fuse-mat-no-subscript\", \"w-full\", \"sm:w-72\", \"mt-4\", \"sm:mt-0\", \"sm:ml-4\", \"bg-default\", 3, \"floatLabel\"], [\"matPrefix\", \"\", 1, \"icon-size-5\", 3, \"svgIcon\"], [\"placeholder\", \"N\\u1ED9i dung t\\u00ECm ki\\u1EBFm\", \"matInput\", \"\", 3, \"ngModel\", \"ngModelChange\", \"keyup.enter\"], [1, \"fuse-mat-no-subscript\", \"w-full\", \"sm:w-36\", \"sm:ml-4\", \"bg-default\"], [\"placeholder\", \"Ch\\u1ECDn role\", 3, \"ngModel\", \"ngModelChange\", \"selectionChange\"], [3, \"value\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [1, \"add-user\"], [1, \"data-table\", \"w-full\", \"mt-4\"], [3, \"rows\", \"columns\", \"paginate\", \"limit\", \"count\", \"actionTemplate\", \"pageChange\"], [\"actionTemplate\", \"\"], [\"mat-icon-button\", \"\", 3, \"click\"], [\"svgIcon\", \"heroicons_outline:pencil-alt\", 1, \"icon-size-5\"], [\"mat-icon-button\", \"\"], [\"svgIcon\", \"heroicons_outline:trash\", 1, \"icon-size-5\"]],\n    template: function UserComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, UserComponent_ng_container_0_Template, 37, 18, \"ng-container\", 0);\n      }\n    },\n    directives: [i2.TranslocoDirective, i3.MatCard, i4.MatButton, i5.MatIcon, i6.GroupListComponent, i7.MatFormField, i7.MatPrefix, i8.MatInput, i9.DefaultValueAccessor, i9.NgControlStatus, i9.NgModel, i10.MatSelect, i11.MatOption, i12.NgForOf, i13.DataTableComponent],\n    styles: [\"mat-paginator .mat-paginator-container{justify-content:end!important}\"]\n  });\n  return UserComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}